# =============================================================================
# NGINX-STYLE CONFIGURATION - TESTING RELATIVE PATH RESOLUTION
# =============================================================================
# This configuration tests the nginx-style path resolution implementation
# All paths are relative to the server root, following nginx conventions
# =============================================================================

server {
	server_name nginx_test
	listen 8084
	host 127.0.0.1
	root /home/ilyam/42/webserver/www
	index index.html
	client_max_body_size 10000

	# ROOT: Main landing page with file upload/delete links
	location / {
		allow_methods GET
		autoindex on
		index index.html
	}

	# UPLOADS: File upload/download/delete using relative paths (nginx-style)
	location /uploads {
		allow_methods GET DELETE POST
		upload_to uploads
		autoindex on
		index index.html
	}

	# CGI SCRIPTS: Python and JavaScript execution using relative paths
	location /cgi-bin {
		allow_methods GET POST
		cgi_path cgi-bin
		cgi_ext .py .js
		index index.html
	}

	# PYTHON SCRIPTS: Single Python files using relative path
	location .py {
		allow_methods GET POST
		cgi_path .
		cgi_ext .py
		index index.html
	}

	# IMAGES: Directory listing for actual image files
	location /imgs {
		allow_methods GET
		autoindex on
		index index.html
	}

	# UPLOAD PAGE: Static upload form
	location /upload.html {
		allow_methods GET POST
		index upload.html
	}

	# DELETE PAGE: Static delete form
	location /delete.html {
		allow_methods GET DELETE
		index delete.html
	}

	# FAVICON: Static favicon file
	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

# =============================================================================
# TESTING INSTRUCTIONS
# =============================================================================
# Start server: ./webserv configs/ilia/nginx_default.conf
# Server will run on port 8084
#
# Test nginx-style path resolution:
# 1. curl http://localhost:8084/                     -> index.html (main page)
# 2. curl http://localhost:8084/uploads/              -> directory listing
# 3. curl -X POST http://localhost:8084/uploads/      -> file upload (uses relative upload_to)
# 4. curl -X DELETE http://localhost:8084/uploads/file.txt -> file deletion
# 5. curl http://localhost:8084/cgi-bin/              -> CGI directory listing
# 6. curl http://localhost:8084/cgi-bin/test.py       -> CGI script execution
# 7. curl http://localhost:8084/test.py               -> Python script execution
# 8. curl http://localhost:8084/imgs/                 -> image directory listing
#
# All paths are now resolved relative to server root, following nginx conventions!
# =============================================================================
