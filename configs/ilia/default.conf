# =============================================================================
# NGINX-STYLE CONFIGURATION - MULTI-SITE SETUP WITH NEW WWW STRUCTURE
# =============================================================================
# This configuration serves three different sites:
# Server 1: webserv_project (main project site) on port 8080
# Server 2: site2 on port 8081
# Server 3: site3 on port 8082
# =============================================================================

# SERVER 1: WEBSERV PROJECT - MAIN SITE WITH FULL FUNCTIONALITY
server {
	server_name ws_default
	listen 8080
	host 127.0.0.1
	root /home/ilyam/42/webserver/www/webserv_project
	index index.html
	client_max_body_size 10000000
	error_page 404 errors/not_found_404.html
	# error_page 413 errors/not_found_404.html # for testing

	# REDIRECTION: Test redirection from /old to redirection page
	location /old {
		allow_methods GET
		return /redirect/redirection.html
		index index.html
	}

	# ROOT: Main landing page with file upload/delete links
	location / {
		allow_methods GET
		autoindex on
		index index.html
	}

	# UPLOADS: File upload/download/delete using relative paths (nginx-style)
	location /uploads {
		allow_methods GET DELETE POST
		upload_to uploads
		autoindex on
		index index.html
	}

	# CGI SCRIPTS: Python and JavaScript execution using relative paths
	location /cgi-bin {
		allow_methods GET POST
		cgi_path cgi-bin
		cgi_ext .py .js
		index index.html
	}

	# PYTHON SCRIPTS: Single Python files using relative path
	location .py {
		allow_methods GET POST
		cgi_path .
		cgi_ext .py
		index index.html
	}

	# IMAGES: Directory listing for actual image files
	location /imgs {
		allow_methods GET
		autoindex on
		index index.html
	}

	# UPLOAD PAGE: Static upload form
	location /upload.html {
		allow_methods GET POST
		index upload.html
	}

	# DELETE PAGE: Static delete form
	location /delete.html {
		allow_methods GET DELETE
		index delete.html
	}

	# FAVICON: Static favicon file
	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

server {
	server_name ws2
	listen 8081
	host 127.0.0.1
	root /home/ilyam/42/webserver/www/webserv_project
	index index.html
	client_max_body_size 10000000

	# UPLOADS: Can delete but NOT upload images
	location /uploads {
		allow_methods GET DELETE
		upload_to uploads
		autoindex on
		index index.html
	}

	# UPLOAD PAGE: Static upload form (disabled for uploads)
	location /upload.html {
		allow_methods GET
		index upload.html
	}

	# DELETE PAGE: Static delete form
	location /delete.html {
		allow_methods GET DELETE
		index delete.html
	}

	# FAVICON: Static favicon file
	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

server {
	server_name ws3
	listen 8082
	host 127.0.0.1
	root /home/ilyam/42/webserver/www/webserv_project
	index index.html
	client_max_body_size 10000000
	error_page 404 errors/not_found_404.html

	# UPLOADS: Can upload but NOT delete images
	location /uploads {
		allow_methods GET POST
		upload_to uploads
		autoindex on
		index index.html
	}

	# UPLOAD PAGE: Static upload form
	location /upload.html {
		allow_methods GET POST
		index upload.html
	}

	# DELETE PAGE: Static delete form (disabled for deletes)
	location /delete.html {
		allow_methods GET
		index delete.html
	}

	# FAVICON: Static favicon file
	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

# SERVER 2: SITE2 - SIMPLE SITE
server {
	server_name site2_server
	listen 8083
	host 127.0.0.1
	root /home/ilyam/42/webserver/www/site2
	index index.html
	client_max_body_size 10000

	# ROOT: Simple site2 landing page
	location / {
		allow_methods GET
		autoindex off
		index index.html
	}

	# FAVICON: Static favicon file
	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

# SERVER 3: SITE3 - SIMPLE SITE
server {
	server_name site3_server
	listen 8084
	host 127.0.0.1
	root /home/ilyam/42/webserver/www/site3
	index index.html
	client_max_body_size 10000

	# ROOT: Simple site3 landing page
	location / {
		allow_methods GET
		autoindex off
		index index.html
	}

	# FAVICON: Static favicon file
	location /favicon.ico {
		allow_methods GET
		index index.html
		autoindex off
	}
}

# =============================================================================
# TESTING INSTRUCTIONS
# =============================================================================
# Start server: ./webserv configs/ilia/default.conf
# Three servers will run simultaneously:
# - Server 1 (webserv_project_server) on port 8080 - main project site
# - Server 2 (site2_server) on port 8081 - simple site2
# - Server 3 (site3_server) on port 8082 - simple site3
#
# Test all three servers:
#
# WEBSERV PROJECT SERVER (port 8080):
# 1. curl http://localhost:8080/                     -> index.html (main page)
# 2. curl http://localhost:8080/old                  -> 302 redirect to /redirect/redirection.html
# 3. curl http://localhost:8080/uploads/              -> directory listing
# 4. curl -X POST http://localhost:8080/uploads/      -> file upload
# 5. curl -X DELETE http://localhost:8080/uploads/file.txt -> file deletion
# 6. curl http://localhost:8080/cgi-bin/              -> CGI directory listing
# 7. curl http://localhost:8080/cgi-bin/test.py       -> CGI script execution
# 8. curl http://localhost:8080/test.py               -> Python script execution
# 9. curl http://localhost:8080/imgs/                 -> image directory listing
#
# SITE2 SERVER (port 8081):
# 1. curl http://localhost:8081/                     -> site2 index.html
# 2. curl http://localhost:8081/favicon.ico          -> favicon
#
# SITE3 SERVER (port 8082):
# 1. curl http://localhost:8082/                     -> site3 index.html
# 2. curl http://localhost:8082/favicon.ico          -> favicon
#
# Each server serves content from its respective directory in the www/ structure!
# =============================================================================
